<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Safe Cracking Puzzle</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 800px;
        width: 100%;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 10px;
        font-size: 2em;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
        font-size: 0.9em;
      }

      .code-input {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .digit-box {
        width: 60px;
        height: 70px;
        font-size: 2em;
        text-align: center;
        border: 3px solid #ddd;
        border-radius: 10px;
        transition: all 0.3s;
        font-weight: bold;
        color: #333;
      }

      .digit-box:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
      }

      .digit-box.valid {
        background-color: #d4edda;
        border-color: #28a745;
      }

      .digit-box.invalid {
        background-color: #f8d7da;
        border-color: #dc3545;
      }

      .rules {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .rule {
        display: flex;
        align-items: center;
        padding: 10px;
        margin: 5px 0;
        border-radius: 5px;
        transition: all 0.3s;
      }

      .rule-icon {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        margin-right: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        flex-shrink: 0;
      }

      .rule.satisfied {
        background: #d4edda;
      }

      .rule.satisfied .rule-icon {
        background: #28a745;
        color: white;
      }

      .rule.unsatisfied {
        background: #fff3cd;
      }

      .rule.unsatisfied .rule-icon {
        background: #ffc107;
        color: white;
      }

      .rule.violated {
        background: #f8d7da;
      }

      .rule.violated .rule-icon {
        background: #dc3545;
        color: white;
      }

      .rule-text {
        flex: 1;
        font-size: 0.9em;
        color: #333;
      }

      .success-message {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        font-size: 1.2em;
        font-weight: bold;
        margin-top: 20px;
        display: none;
        animation: slideIn 0.5s;
      }

      .success-message.show {
        display: block;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .button-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
      }

      button {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
      }

      .reset-btn {
        background: #dc3545;
        color: white;
      }

      .reset-btn:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
      }

      .hint-btn {
        background: #667eea;
        color: white;
      }

      .hint-btn:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .position-labels {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin-bottom: 5px;
        flex-wrap: wrap;
      }

      .position-label {
        width: 60px;
        text-align: center;
        font-size: 0.8em;
        color: #666;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîê Safe Cracking Puzzle</h1>
      <p class="subtitle">Enter digits 0-9, each used exactly once</p>

      <div class="position-labels">
        <div class="position-label">1st</div>
        <div class="position-label">2nd</div>
        <div class="position-label">3rd</div>
        <div class="position-label">4th</div>
        <div class="position-label">5th</div>
        <div class="position-label">6th</div>
        <div class="position-label">7th</div>
        <div class="position-label">8th</div>
        <div class="position-label">9th</div>
        <div class="position-label">10th</div>
      </div>

      <div class="code-input" id="codeInput">
        <input type="text" class="digit-box" maxlength="1" data-index="0" />
        <input type="text" class="digit-box" maxlength="1" data-index="1" />
        <input type="text" class="digit-box" maxlength="1" data-index="2" />
        <input type="text" class="digit-box" maxlength="1" data-index="3" />
        <input type="text" class="digit-box" maxlength="1" data-index="4" />
        <input type="text" class="digit-box" maxlength="1" data-index="5" />
        <input type="text" class="digit-box" maxlength="1" data-index="6" />
        <input type="text" class="digit-box" maxlength="1" data-index="7" />
        <input type="text" class="digit-box" maxlength="1" data-index="8" />
        <input type="text" class="digit-box" maxlength="1" data-index="9" />
      </div>

      <div class="rules">
        <div class="rule" id="rule1">
          <div class="rule-icon">?</div>
          <div class="rule-text">All digits from 0 to 9 are used exactly once</div>
        </div>
        <div class="rule" id="rule2">
          <div class="rule-icon">?</div>
          <div class="rule-text">
            The sum of the 2nd, 5th, 6th, and 8th digits is a single-digit number
          </div>
        </div>
        <div class="rule" id="rule3">
          <div class="rule-icon">?</div>
          <div class="rule-text">The 4th digit is a perfect square (0, 1, 4, or 9)</div>
        </div>
        <div class="rule" id="rule4">
          <div class="rule-icon">?</div>
          <div class="rule-text">The 3rd digit is 1</div>
        </div>
        <div class="rule" id="rule5">
          <div class="rule-icon">?</div>
          <div class="rule-text">The sum of the 4th and 7th digits is a perfect square</div>
        </div>
        <div class="rule" id="rule6">
          <div class="rule-icon">?</div>
          <div class="rule-text">The value of the 10th digit is twice that of the 2nd</div>
        </div>
        <div class="rule" id="rule7">
          <div class="rule-icon">?</div>
          <div class="rule-text">
            The product of the 4th and 6th digits equals the product of the 10th and 2nd digits
          </div>
        </div>
        <div class="rule" id="rule8">
          <div class="rule-icon">?</div>
          <div class="rule-text">The 5 is next to the 6 but not the 4</div>
        </div>
      </div>

      <div class="button-container">
        <button class="reset-btn" onclick="resetCode()">Reset</button>
        <button class="hint-btn" onclick="showHint()">Show Hint</button>
      </div>

      <div class="success-message" id="successMessage">
        üéâ Congratulations! You've cracked the safe! üéâ
      </div>
    </div>

    <script>
      const inputs = document.querySelectorAll(".digit-box")

      // Handle input and navigation
      inputs.forEach((input, index) => {
        input.addEventListener("input", (e) => {
          const value = e.target.value

          // Only allow digits 0-9
          if (!/^[0-9]$/.test(value)) {
            e.target.value = ""
            return
          }

          // Move to next input if value entered
          if (value && index < inputs.length - 1) {
            inputs[index + 1].focus()
          }

          validateCode()
        })

        input.addEventListener("keydown", (e) => {
          // Move to previous input on backspace if empty
          if (e.key === "Backspace" && !e.target.value && index > 0) {
            inputs[index - 1].focus()
          }
          // Arrow key navigation
          if (e.key === "ArrowLeft" && index > 0) {
            inputs[index - 1].focus()
          }
          if (e.key === "ArrowRight" && index < inputs.length - 1) {
            inputs[index + 1].focus()
          }
        })

        // Select all on focus for easy replacement
        input.addEventListener("focus", (e) => {
          e.target.select()
        })
      })

      function getDigits() {
        return Array.from(inputs).map((input) => (input.value ? parseInt(input.value) : null))
      }

      function isPerfectSquare(n) {
        if (n === null || n < 0) return false
        const sqrt = Math.sqrt(n)
        return sqrt === Math.floor(sqrt)
      }

      function validateCode() {
        const digits = getDigits()
        const rules = []

        // Rule 1: All digits 0-9 used exactly once
        const filledDigits = digits.filter((d) => d !== null)
        const uniqueDigits = new Set(filledDigits)
        const rule1 =
          filledDigits.length === 10 &&
          uniqueDigits.size === 10 &&
          filledDigits.every((d) => d >= 0 && d <= 9)
        rules.push(rule1)

        // Rule 2: Sum of 2nd, 5th, 6th, 8th is single digit
        const sum2568 = [digits[1], digits[4], digits[5], digits[7]]
        const rule2 = sum2568.every((d) => d !== null)
          ? sum2568.reduce((a, b) => a + b, 0) < 10
          : null
        rules.push(rule2)

        // Rule 3: 4th digit is perfect square
        const rule3 = digits[3] !== null ? isPerfectSquare(digits[3]) : null
        rules.push(rule3)

        // Rule 4: 3rd digit is 1
        const rule4 = digits[2] !== null ? digits[2] === 1 : null
        rules.push(rule4)

        // Rule 5: Sum of 4th and 7th is perfect square
        const rule5 =
          digits[3] !== null && digits[6] !== null ? isPerfectSquare(digits[3] + digits[6]) : null
        rules.push(rule5)

        // Rule 6: 10th digit is twice the 2nd
        const rule6 = digits[1] !== null && digits[9] !== null ? digits[9] === 2 * digits[1] : null
        rules.push(rule6)

        // Rule 7: Product of 4th and 6th equals product of 10th and 2nd
        const rule7 =
          digits[3] !== null && digits[5] !== null && digits[9] !== null && digits[1] !== null
            ? digits[3] * digits[5] === digits[9] * digits[1]
            : null
        rules.push(rule7)

        // Rule 8: 5 is next to 6 but not 4
        let rule8 = null
        if (filledDigits.length === 10) {
          const pos5 = digits.indexOf(5)
          const pos6 = digits.indexOf(6)
          const pos4 = digits.indexOf(4)

          if (pos5 !== -1 && pos6 !== -1 && pos4 !== -1) {
            const nextTo6 = Math.abs(pos5 - pos6) === 1
            const notNextTo4 = Math.abs(pos5 - pos4) !== 1
            rule8 = nextTo6 && notNextTo4
          }
        }
        rules.push(rule8)

        // Update UI for each rule
        rules.forEach((result, index) => {
          const ruleElement = document.getElementById(`rule${index + 1}`)
          const icon = ruleElement.querySelector(".rule-icon")

          ruleElement.classList.remove("satisfied", "unsatisfied", "violated")

          if (result === true) {
            ruleElement.classList.add("satisfied")
            icon.textContent = "‚úì"
          } else if (result === false) {
            ruleElement.classList.add("violated")
            icon.textContent = "‚úó"
          } else {
            ruleElement.classList.add("unsatisfied")
            icon.textContent = "?"
          }
        })

        // Update input styling
        inputs.forEach((input) => {
          input.classList.remove("valid", "invalid")
        })

        if (rule1) {
          inputs.forEach((input) => {
            input.classList.add("valid")
          })
        } else if (filledDigits.length === 10) {
          inputs.forEach((input) => {
            input.classList.add("invalid")
          })
        }

        // Check if puzzle is solved
        const allSatisfied = rules.every((r) => r === true)
        const successMessage = document.getElementById("successMessage")

        if (allSatisfied) {
          successMessage.classList.add("show")
        } else {
          successMessage.classList.remove("show")
        }
      }

      function resetCode() {
        inputs.forEach((input) => {
          input.value = ""
          input.classList.remove("valid", "invalid")
        })
        document.getElementById("successMessage").classList.remove("show")
        validateCode()
        inputs[0].focus()
      }

      function showHint() {
        // Give a helpful hint
        alert(
          "Hint: Start with what you know for certain!\n\n" +
            "‚Ä¢ The 3rd digit MUST be 1\n" +
            "‚Ä¢ The 4th digit can only be 0, 1, 4, or 9 (perfect squares)\n" +
            "‚Ä¢ Since digit 1 is used in position 3, the 4th digit must be 0, 4, or 9\n" +
            "‚Ä¢ Think about the relationship between 2nd and 10th digits (one is double the other)",
        )
      }

      // Initial validation
      validateCode()
      inputs[0].focus()
    </script>
  </body>
</html>
